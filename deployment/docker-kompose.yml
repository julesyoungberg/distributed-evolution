---
version: '3'

services:
    master:
        image: julesyoungberg/distributed-evolution-master
        environment: 
            HTTP_PORT: 9000
            WORKERS: 5
            WORKER_THREADS: 5
            REDIS_MASTER_NAME: mymaster
            RPC_PORT: 8080
            SENTINEL_ADDRESS: sentinel:26379
        ports:
            - 9000:9000
            - 8080
        restart: always
    worker:
        image: julesyoungberg/distributed-evolution-worker
        environment: 
            MASTER_URL: master:8080
            REDIS_MASTER_NAME: mymaster
            SENTINEL_ADDRESS: sentinel:26379
            THREADS: 5
        restart: always
    ui:
        image: julesyoungberg/distributed-evolution-ui
        environment: 
            API_URL: http://localhost:9000
            CHANNEL_URL: ws://localhost:9000/subscribe
            NODE_ENV: development
            PORT: 3000
        ports:
            - 3000:3000
        restart: always
        volumes:
            - ./ui/:/app
            - /app/node_modules/
            - /app/.next
    redis-master:
        image: redis:3
        ports:
            - 6379
        restart: always
    redis-slave:
        image: redis:3
        command: redis-server --slaveof redis-master 6379
        links:
            - redis-master
        ports:
            - 6379
        restart: always
    sentinel:
        image: julesyoungberg/distributed-evolution-sentinel
        environment:
            SENTINEL_DOWN_AFTER: 5000
            SENTINEL_FAILOVER: 5000
        links:
            - redis-master
            - redis-slave
        ports:
            - 26379
        restart: always

networks:
    default:
        external:
            name: distributed-ga
